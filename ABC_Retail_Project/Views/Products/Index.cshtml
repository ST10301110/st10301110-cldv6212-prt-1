@model IEnumerable<Product>

@{
    ViewData["Title"] = "Products";
}

<h2>Products</h2>

<!-- Search Box -->
<div class="row mb-4">
    <div class="col-md-6">
        <form asp-action="Index" method="get" class="form-inline">
            <div class="input-group">
                <input type="text" class="form-control" name="searchString"
                       value="@ViewBag.SearchString" placeholder="Search products by name, description, or price...">
                <div class="input-group-append">
                    <button class="btn btn-outline-primary" type="submit">
                        <i class="fas fa-search"></i> Search
                    </button>
                    @if (!string.IsNullOrEmpty(ViewBag.SearchString))
                    {
                        <a asp-action="Index" class="btn btn-outline-secondary">Clear</a>
                    }
                </div>
            </div>
        </form>
    </div>
    <div class="col-md-6 text-right">
        <a asp-action="Create" class="btn btn-primary">
            <i class="fas fa-plus"></i> Create New Product
        </a>
    </div>
</div>

@if (TempData["SearchMessage"] != null)
{
    <div class="alert alert-info alert-dismissible fade show" role="alert">
        @TempData["SearchMessage"]
        <button type="button" class="close" data-dismiss="alert" aria-label="Close">
            <span aria-hidden="true">&times;</span>
        </button>
    </div>
}

@if (TempData["SuccessMessage"] != null)
{
    <div class="alert alert-success alert-dismissible fade show" role="alert">
        @TempData["SuccessMessage"]
        <button type="button" class="close" data-dismiss="alert" aria-label="Close">
            <span aria-hidden="true">&times;</span>
        </button>
    </div>
}

@if (TempData["ErrorMessage"] != null)
{
    <div class="alert alert-danger alert-dismissible fade show" role="alert">
        @TempData["ErrorMessage"]
        <button type="button" class="close" data-dismiss="alert" aria-label="Close">
            <span aria-hidden="true">&times;</span>
        </button>
    </div>
}

@if (Model.Any())
{
    <div class="table-responsive">
        <table class="table table-striped table-hover">
            <thead class="thead-dark">
                <tr>
                    <th>Name</th>
                    <th>Description</th>
                    <th>Price</th>
                    <th>Stock</th>
                    <th>Image</th>
                    <th>Actions</th>
                </tr>
            </thead>
            <tbody>
                @foreach (var item in Model)
                {
                    <tr>
                        <td>
                            <strong>@item.Name</strong>
                        </td>
                        <td style="max-width: 200px;">
                            <span class="text-truncate d-inline-block" style="max-width: 100%;"
                                  title="@item.Description">
                                @item.Description
                            </span>
                        </td>
                        <td>
                            <span class="badge badge-success">R @item.Price.ToString("N2")</span>
                        </td>
                        <td>
                            @if (item.StockQuantity > 10)
                            {
                                <span class="badge badge-success">@item.StockQuantity</span>
                            }
                            else if (item.StockQuantity > 0)
                            {
                                <span class="badge badge-warning">@item.StockQuantity</span>
                            }
                            else
                            {
                                <span class="badge badge-danger">Out of Stock</span>
                            }
                        </td>
                        <td>
                            @if (!string.IsNullOrEmpty(item.ImageUrl))
                            {
                                <img src="@item.ImageUrl" alt="@item.Name"
                                     style="width: 60px; height: 60px; object-fit: cover;"
                                     class="img-thumbnail rounded"
                                     data-toggle="tooltip" title="@item.Name" />
                            }
                            else
                            {
                                <span class="text-muted">
                                    <i class="fas fa-image"></i> No Image
                                </span>
                            }
                        </td>
                        <td>
                            <div class="btn-group" role="group">
                                <a asp-action="Details" asp-route-id="@item.RowKey"
                                   class="btn btn-info btn-sm" title="View Details">
                                    <i class="fas fa-eye"></i>
                                </a>
                                <a asp-action="Edit" asp-route-id="@item.RowKey"
                                   class="btn btn-warning btn-sm" title="Edit">
                                    <i class="fas fa-edit"></i>
                                </a>
                                <a asp-action="Delete" asp-route-id="@item.RowKey"
                                   class="btn btn-danger btn-sm" title="Delete">
                                    <i class="fas fa-trash"></i>
                                </a>
                            </div>
                        </td>
                    </tr>
                }
            </tbody>
        </table>
    </div>
}
else
{
    <div class="alert alert-warning text-center">
        <h4>No Products Found</h4>
        @if (!string.IsNullOrEmpty(ViewBag.SearchString))
        {
            <p>No products match your search criteria "<strong>@ViewBag.SearchString</strong>".</p>
            <a asp-action="Index" class="btn btn-primary">View All Products</a>
        }
        else
        {
            <p>No products available. <a asp-action="Create" class="btn btn-primary">Create the first product</a></p>
        }
    </div>
}

@section Scripts {
    <script src="https://kit.fontawesome.com/your-fontawesome-kit.js" crossorigin="anonymous"></script>
    <script>
        $(function () {
            $('[data-toggle="tooltip"]').tooltip();

            setTimeout(function() {
                $('.alert').alert('close');
            }, 5000);
        });
    </script>
}